#Lab8 文件读写
##8-1 读写文件操作的实现
---------------------
###读写文件操作的实现
读写文件的实现过程如下
1. 对于初始偏移未对齐的块, 读写一整块的部分数据
2. 连续读写文件中间的整块
3. 如果最后有一个部分块需要读写, 再取出最后一块读写部分数据
###管道机制的实现方案
将管道作为vfs的inode的一种特殊实现, 内部是一个字符队列. 实现open, close, read, write等基本操作.
向管道写时向字符队列push写入的值, 读时从字符队列pop即可.
##8-2加载可执行文件的实现
基本的加载elf文件的方式和之前lab从内存中加载相似, 只是从内存拷贝变为对文件的读写. 
在栈上设置argc和argv的方式如下:
对于内核态, 将栈顶布局为:
```
----------------
|_argv[n-1]    |
|              |
|              |
----------------
|_argv[n-2]    |
|              |
|              |
----------------
...
----------------
|_argv[0]      |
|              |
|              |
----------------
|&_argv[n-1]   |
----------------
|&_argv[n-2]   |
----------------
...
----------------
|&_argv[0]     |
----------------
|&argc         |
----------------
```
然后启动时进入`initcode.S`再次完成最后设置:
```
----------------
|_argv[n-1]    |
|              |
|              |
----------------
|_argv[n-2]    |
|              |
|              |
----------------
...
----------------
|_argv[0]      |
|              |
|              |
----------------
|&_argv[n-1]   |
----------------
|&_argv[n-2]   |
----------------
...
----------------
|&_argv[0]=argv|
----------------
|&argc         |
----------------
|&argv         |
----------------
|&argc         |
----------------
```
###软硬链接机制的实现
硬链接的实现方式比较容易, 在sfs中增加inode的引用计数, 然后让不同的文件名指向同一个inode即可.
软链接需要在sfs中增加一个文件类型软链接, 软链接作为一个文件内部存放链接的文件名, 然后读到这个文件名后再次去读链接的文件即可.

##与OS课程的关系
使用的知识点: 文件系统的读写与inode
没有涉及的知识点: 详细的设备IO操作的实现.
